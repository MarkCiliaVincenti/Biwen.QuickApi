对象映射
=====================

系统提供源生成器支持[Biwen.AutoClassGen](https://github.com/vipwan/Biwen.AutoClassGen/blob/master/Gen-Dto.md),以及内置基于`Mapster`的对象映射
当然如果你的习惯是使用`AutoMapper`等三方库也是可以的


源生成器方式
---------------------

```csharp
namespace Biwen.AutoClassGen.TestConsole.Entitys
{
    public class User : Info
    {
        /// <summary>
        /// Id
        /// </summary>
        public string Id { get; set; } = null!;
        /// <summary>
        /// first name
        /// </summary>
        public string FirstName { get; set; } = null!;
        /// <summary>
        /// last name
        /// </summary>
        public string LastName { get; set; } = null!;
        /// <summary>
        /// age
        /// </summary>
        public int? Age { get; set; }
        /// <summary>
        /// fullname
        /// </summary>
        public string? FullName => $"{FirstName} {LastName}";
    }
    public abstract class Info : Other
    {
        /// <summary>
        /// email
        /// </summary>
        public string? Email { get; set; }
    }
    public abstract class Other
    {
        /// <summary>
        /// remark
        /// </summary>
        public string? Remark { get; set; }
    }
}

using Biwen.AutoClassGen.TestConsole.Entitys;
namespace Biwen.AutoClassGen.TestConsole.Dtos
{
    [AutoDto(typeof(User), nameof(User.Id), "TestCol")]
    public partial class UserDto
    {
    }

    /// <summary>
    /// C#11(NET7+) support generic attribute
    /// </summary>
    [AutoDto<User>(nameof(User.Email), "TestCol")]
    public partial class User3Dto
    {
    }
}

```

源生成器将自动生成如下代码:
```csharp
// <auto-generated />
using System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using Biwen.AutoClassGen.TestConsole.Entitys;

#pragma warning disable
namespace Biwen.AutoClassGen.TestConsole.Dtos
{
    public partial class UserDto
    {
        /// <inheritdoc cref = "User.FirstName"/>
        public string FirstName { get; set; }
        /// <inheritdoc cref = "User.LastName"/>
        public string LastName { get; set; }
        /// <inheritdoc cref = "User.Age"/>
        public int? Age { get; set; }
        /// <inheritdoc cref = "User.FullName"/>
        public string? FullName { get; set; }
        /// <inheritdoc cref = "Info.Email"/>
        public string? Email { get; set; }
        /// <inheritdoc cref = "Other.Remark"/>
        public string? Remark { get; set; }
    }
}

namespace Biwen.AutoClassGen.TestConsole.Entitys
{
    using Biwen.AutoClassGen.TestConsole.Dtos;
    public static partial class UserToUserDtoExtentions
    {
        /// <summary>
        /// mapper to UserDto
        /// </summary>
        /// <returns></returns>
        public static UserDto MapperToDto(this User model)
        {
            return new UserDto()
            {
                FirstName = model.FirstName,
                LastName = model.LastName,
                Age = model.Age,
                FullName = model.FullName,
                Email = model.Email,
                Remark = model.Remark,
            };
        }
    }
}
#pragma warning restore
```
> [!NOTE]
> 请注意MapperTo扩展函数仅针对属性相同的情况,如果需要映射不同的属性名或特殊映射规则

虽然源生成器的性能最优,但是针对一些特殊情况,源生成器可能满足不了,你必须借助`Mapster`等三方库,请根据自己的情况加以选择!


参考测试
---------------------
```csharp
public class MappingTest
{
    [Fact]
    public void IMapperTest()
    {
        var services = new ServiceCollection();
        services.AddMapsterMapper();
        var provider = services.BuildServiceProvider();
        var mapper = provider.GetRequiredService<IMapper>();

        var user = new User
        {
            Name = "Tom",
            Age = 10,
            Address = "China"
        };

        var userDto = mapper.Map<UserDto>(user);
        Assert.NotNull(userDto);
        Assert.Equal(user.Name, userDto.Name);
        Assert.Equal(user.Age, userDto.Age);
    }

    #region model

    //定义User类型:
    public class User
    {
        public string? Name { get; set; }
        public int Age { get; set; }
        public string? Address { get; set; }
    }
    //定义UserDto类型:
    public class UserDto
    {
        public string? Name { get; set; }
        public int Age { get; set; }
    }
    #endregion
}
```

API文档
---------------------

